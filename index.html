<!DOCTYPE html>
<html lang="es">
<head>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fingerprintjs/fingerprintjs@3/dist/fp.min.js"></script>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>üè¥‚Äç‚ò†Ô∏è CASINO PIRATA - CARTAS üè¥‚Äç‚ò†Ô∏è</title>
  <style>
   body {
  margin: 0;
  background-color: #0b0b0b;
  font-family: 'Trebuchet MS', sans-serif;
  color: #f2e3b6;
  text-align: center;
}
h1 {
  color: #f5e9c4;
  font-size: 24px;
  margin: 10px 0 5px;
  text-shadow: 0 0 4px #000;
}

    .top-info {
      margin: 2px 0;
      font-size: 14px;
    }

    .frase-juego {
      font-size: 13px;
      margin: 4px 0 6px;
      line-height: 1;
      font-weight: normal;
      margin-bottom: 5px;
    }

    h4 {
      font-size: 14px;
      margin: 5px 0 0;
    }

    .hidden {
      display: none;
    }

    .input-container input,
    #username {
      padding: 12px;
      font-size: 16px;
      width: 80%;
      border-radius: 10px;
      text-align: center;
      background: #1a1a1a;
      color: gold;
      border: 2px solid gold;
    }
    .input-container input.error {
      border: 2px solid red;
    }
    .btn,
    button {
      margin-top: 20px;
      padding: 15px 25px;
      font-size: 18px;
      border: none;
      border-radius: 10px;
      background: linear-gradient(45deg, #8b0000, #b8860b);
      color: white;
      font-weight: bold;
      box-shadow: 0 0 10px #ffd700;
    }

    .whatsapp {
      background-color: #128C7E;
      color: white;
      margin-top: 20px;
      padding: 12px;
      display: inline-block;
      border-radius: 8px;
      text-decoration: none;
      font-weight: bold;
      box-shadow: 0 0 10px #128C7E;
    }

    .game-area {
      max-width: 420px;
      margin: auto;
      padding-bottom: 60px;
    }

    .card {
  width: 60px;
  height: 80px;
  border-radius: 10px;
  perspective: 1000px;
  background: #1f1f1f;
  border: 2px solid #7d5a3c;
  box-shadow: 0 0 6px #000;
}

.card-inner {
  position: relative;
  width: 100%;
  height: 100%;
  transition: transform 1s;
  transform-style: preserve-3d;
}

.card.flipped .card-inner {
  transform: rotateY(180deg);
}

    .card-front, .card-back {
      position: absolute;
      width: 100%;
      height: 100%;
      backface-visibility: hidden;
      border-radius: 10px;
      display: flex;
      justify-content: center;
      align-items: center;
      font-weight: bold;
      font-size: 20px;
    }

    .card-front {
  background-color: #263238;
  color: gold;
  font-size: 28px;
  display: flex;
  justify-content: center;
  align-items: center;
  border-radius: 10px;
}

.card-back {
  transform: rotateY(180deg);
  flex-direction: column;
  background-color: #5c4033;
  color: #fff;
  border-radius: 10px;
  display: flex;
  justify-content: center;
  align-items: center;
  font-weight: bold;
  font-size: 18px;
}

    .prize-list {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 10px;
      margin: 10px 0 15px;
    }

    .prize-item {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 6px;
  height: 75px;
  background-color: #2e1f1f;
  border: 2px solid #8b5e3c;
  border-radius: 12px;
  font-size: 14px;
  color: #f5e9c4;
  box-sizing: border-box;
  overflow: hidden;
  box-shadow: 0 0 8px #00000088 inset;
}

.premio-box {
  background-color: #d4af37;
  color: #000;
  padding: 2px 6px;
  border-radius: 6px;
  display: inline-block;
  font-size: 10px;
  font-weight: bold;
  text-align: center;
  line-height: 1.2;
  max-width: 95%;
  word-wrap: break-word;
  box-shadow: 0 0 4px #000 inset;
}

.card-grid-wrapper {
    padding: 15px 12px;
  border: 2px solid #5e4025;
  background-color: #1a1a1a;
  border-radius: 10px;
  margin: 20px auto;
  display: flex;
  justify-content: center;
  align-items: center;
  max-width: 420px;
  box-shadow: 0 0 8px #000;
}

.card-grid {
  display: grid;
  grid-template-columns: repeat(6, 60px);
  gap: 10px;
  justify-content: center;
}

#result {
  font-size: 18px;
  margin-top: 10px;
  color: #f2e3b6;
  background-color: #2c2b28;
  border: 2px solid #800000;
  border-radius: 10px;
  display: inline-block;
  padding: 10px 15px;
  font-weight: bold;
  width: 100%;
  max-width: 420px;
  box-sizing: border-box;
  box-shadow: 0 0 8px #000;
}

    .reclamo-info {
      margin-top: 10px;
      font-size: 10px;
      font-weight: bold;
      color: white;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .card.disabled {
      opacity: 0.4;
      pointer-events: none;
      filter: grayscale(100%);
    }

    #info-footer {
  position: fixed;
  bottom: 0;
  width: 100%;
  background: #151515;
  color: #d4af37;
  border-radius: 12px 12px 0 0;
  padding: 1rem 0.5rem;
  box-shadow: 0 0 12px #8b5e3c;
  font-weight: bold;
  text-align: center;
  z-index: 999;
}

    #info-footer a {
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <div id="start-screen">
    <div class="container">
        <h1 style="font-size: 1.8rem; margin-top: 10px; color: #f2e3b6; text-shadow: 0 0 10px #000;">
            ‚öì CASINO PIRATA - CARTAS ‚öì
          </h1>
      <input id="username" placeholder="ü¶ú INGRES√Å TU NOMBRE PIRATA üí∞" style="
  padding: 12px;
  font-size: 16px;
  width: 80%;
  border: 2px solid #a97c50;
  border-radius: 10px;
  background: #1b1a1a;
  color: #f2e3b6;
  text-align: center;
  box-shadow: 0 0 6px #000;
" />
     <button onclick="startGame()" style="
     margin-top: 20px;
     padding: 15px 25px;
     font-size: 18px;
     border: none;
     border-radius: 10px;
     background: linear-gradient(45deg, #6a1b09, #c99746);
     color: #fff;
     font-weight: bold;
     box-shadow: 0 0 10px #000;
   ">
     üè¥‚Äç‚ò†Ô∏è ENTRAR AL BARCO üè¥‚Äç‚ò†Ô∏è
   </button>
   <div id="info-footer">
    <div style="font-size: 1.3rem; color: #f2e3b6;">‚öì CASINO PIRATA ‚öì</div>
    <div style="margin-top: 5px; color: #f2e3b6;">üìû SOPORTE ACTIVO 24HS - NAVEGAMOS SIN ESCALAS üß≠</div>
        <a href="https://hoo.be/redpirata24hs-" target="_blank" class="whatsapp" style="
          display: inline-block;
          margin-top: 10px;
          padding: 10px 16px;
          background-color: #1f7357;
          color: #f2f2f2;
          border-radius: 8px;
          text-decoration: none;
          font-weight: bold;
          box-shadow: 0 0 8px #000;
        ">üí¨ HABL√Å CON LA TRIPULACI√ìN</a>
      </div>
    </div>
  </div>

  <div id="game-screen" class="hidden">
    <div class="game-area">
        <h1>CASINO PIRATA - CARTAS</h1>
        <p class="top-info">üìÖ <span id="fecha"></span> üïí <span id="hora"></span></p>
        <p class="top-info">üë§ <span id="nombre-usuario"></span></p>
        <p class="frase-juego">üè¥‚Äç‚ò†Ô∏è Destap√° los cofres... ¬°Si hay 3 iguales, GAN√ÅS el bot√≠n! üè¥‚Äç‚ò†Ô∏è</p>
        <h4>üí∞ Tesoros posibles:</h4>
        <div class="prize-list">
          <div class="prize-item" style="background-color: #0b6623;">ü™ô <span class="premio-box">2.500 GRATIS</span></div>
          <div class="prize-item" style="background-color: #8B0000;">üè∫ <span class="premio-box">100% BONO</span></div>
          <div class="prize-item" style="background-color: #A0522D;">ü¶ú <span class="premio-box">50% BONO</span></div>
          <div class="prize-item" style="background-color: #1ff12d;">üó∫Ô∏è <span class="premio-box">20% BONO</span></div>
          <div class="prize-item" style="background-color: #1E90FF;">üí∞ <span class="premio-box">10.000 GRATIS</span></div>
          <div class="prize-item" style="background-color: #483D8B;">‚õµÔ∏è <span class="premio-box">5.000 GRATIS</span></div>
          <div class="prize-item" style="background-color: #FFD700;">üè¥‚Äç‚ò†Ô∏è <span class="premio-box">JACKPOT PIRATA</span></div>
          <div class="prize-item" style="background-color: #2F4F4F;">ü¶à <span class="premio-box">100.000 GRATIS</span></div>
        </div>
        <div class="card-grid-wrapper">
          <div class="card-grid" id="cardGrid"></div>
        </div>
        <div id="result"></div>
        <p class="reclamo-info">üì≤ SAC√Å CAPTURA Y ENVIANOS POR WHATSAPP PARA RECLAMAR TU TESORO</p>
      </div>
      </div>
      
      <script>
      const SUPABASE_URL = 'https://ueiiyibsnmapzygpmeza.supabase.co';
      const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVlaWl5aWJzbm1hcHp5Z3BtZXphIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTEzODc2NzMsImV4cCI6MjA2Njk2MzY3M30.8yDCfUXBhqeEyFvPL5Pz7W5WWlbK4N25UOEXx4n1hdo';
      const client = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
      const hoy = new Date().toISOString().split('T')[0];
      let fingerprint = "";
      let casino = "CASINO PIRATA - CARTAS";
      
      let fpReady = FingerprintJS.load().then(fp => fp.get().then(result => {
        fingerprint = result.visitorId;
      }));
      
      const premios = [
        { nombre: '2.500 GRATIS', emoji: 'ü™ô', fondo: '#0b6623', cantidad: 4 },
        { nombre: '100% BONO', emoji: 'üè∫', fondo: '#8B0000', cantidad: 3 },
        { nombre: '50% BONO', emoji: 'ü¶ú', fondo: '#A0522D', cantidad: 3 },
        { nombre: '20% BONO', emoji: 'üó∫Ô∏è', fondo: '#1ff12d', cantidad: 4 },
        { nombre: '10.000 GRATIS', emoji: 'üí∞', fondo: '#1E90FF', cantidad: 3 },
        { nombre: '5.000 GRATIS', emoji: '‚õµÔ∏è', fondo: '#483D8B', cantidad: 3 },
        { nombre: 'JACKPOT PIRATA', emoji: 'üè¥‚Äç‚ò†Ô∏è', fondo: '#FFD700', cantidad: 2 },
        { nombre: '100.000 GRATIS', emoji: 'ü¶à', fondo: '#2F4F4F', cantidad: 2 },
      ];
      
      let username = "";
      let ganador = false;

    async function startGame() {
  const input = document.getElementById('username');
  const nombre = input.value.trim();
  if (!nombre) {
  input.classList.add('error');
  input.style.border = '2px solid red';
  return;
}
input.classList.remove('error');
input.style.border = 'none';
  username = nombre;
  await fpReady;
  while (!fingerprint) await new Promise(r => setTimeout(r, 50));
  const jugado = await yaJugoHoy(username);

  if (jugado) {
    document.getElementById('start-screen').classList.add('hidden');
    document.getElementById('game-screen').classList.remove('hidden');
    document.getElementById('nombre-usuario').textContent = username;
    const now = new Date();
    document.getElementById('fecha').textContent = now.toLocaleDateString('es-AR');
    document.getElementById('hora').textContent = now.toLocaleTimeString('es-AR', {
      timeZone: 'America/Argentina/Buenos_Aires',
      hour: '2-digit',
      minute: '2-digit',
      second: '2-digit',
      hour12: false
    });

    // mostrar cartas pero sin permitir girar
    loadCards();
setTimeout(() => {
  document.querySelectorAll('.card').forEach(c => {
    c.classList.add('disabled');
    c.onclick = null;
  });
}, 100); // le damos un mini delay para que ya est√©n montadas
    document.getElementById('result').innerHTML = `
  <div style="font-size: 20px; margin-bottom: 6px;">üõë YA JUGASTE HOY üõë</div>
  <div style="display: flex; justify-content: center; align-items: center; gap: 10px; flex-wrap: wrap;">
    <span>üë§ ${jugado.usuarioReal.toUpperCase()}</span>
    <span>üéÅ ${jugado.premio}</span>
  </div>
  <div style="font-size: 11px; margin-top: 6px;">üì≤ Si cre√©s que esto es un error, contactanos por WhatsApp.</div>
  <a class="whatsapp" href="https://hoo.be/redpirata24hs-" target="_blank" style="margin-top: 6px;">üìû CONTACTAR</a>
`;
    return;
  }

  // si no jug√≥, contin√∫a normal
  input.classList.remove('error');
  document.getElementById('start-screen').classList.add('hidden');
  document.getElementById('game-screen').classList.remove('hidden');
  document.getElementById('nombre-usuario').textContent = nombre;
  const now = new Date();
  document.getElementById('fecha').textContent = now.toLocaleDateString('es-AR');
  document.getElementById('hora').textContent = now.toLocaleTimeString('es-AR', {
    timeZone: 'America/Argentina/Buenos_Aires',
    hour: '2-digit',
    minute: '2-digit',
    second: '2-digit',
    hour12: false
  });
  loadCards();
}

    function loadCards() {
  const grid = document.getElementById('cardGrid');
grid.innerHTML = '';
selected = [];
ganador = false;

// üëâ Nueva mezcla random por cantidad fija
const mezclaFinal = [];
premios.forEach(p => {
  for (let i = 0; i < p.cantidad; i++) {
    mezclaFinal.push({ ...p });
  }
});
mezclaFinal.sort(() => Math.random() - 0.5);

  mezclaFinal.forEach(carta => {
    const cartaEl = document.createElement('div');
    cartaEl.className = 'card';
    cartaEl.dataset.tipo = carta.nombre;
    cartaEl.dataset.emoji = carta.emoji;
    cartaEl.dataset.color = carta.fondo;

    cartaEl.onclick = () => girarCarta(cartaEl);

    const inner = document.createElement('div');
    inner.className = 'card-inner';

    const front = document.createElement('div');
    front.className = 'card-front';
    front.innerHTML = `<div style="font-size: 30px;">‚öìÔ∏è</div>`;

    const back = document.createElement('div');
    back.className = 'card-back';
    back.style.background = carta.fondo;
    back.innerHTML = `
      <div style="font-size: 20px; margin-bottom: 3px;">${carta.emoji}</div>
      <div class="premio-box">${carta.nombre}</div>
    `;

    inner.appendChild(front);
    inner.appendChild(back);
    cartaEl.appendChild(inner);
    grid.appendChild(cartaEl);
  });
}

function girarCarta(carta) {
  if (carta.classList.contains('flipped') || ganador) return;

  let cartaReal = carta;

  const tipo = cartaReal.dataset.tipo;
  const emoji = cartaReal.dataset.emoji;
  const fondo = cartaReal.dataset.color;

  // Giramos la carta tocada pero le ponemos el contenido de la real
  carta.classList.add('flipped');
  const back = carta.querySelector('.card-back');
  back.style.background = fondo;
  back.innerHTML = `
    <div style="font-size: 20px; margin-bottom: 3px;">${emoji}</div>
    <div class="premio-box">${tipo}</div>
  `;

  // L√≥gica de conteo y verificaci√≥n
  selected.push(tipo);
  const conteo = selected.reduce((acc, n) => {
    acc[n] = (acc[n] || 0) + 1;
    return acc;
  }, {});

  if (conteo[tipo] === 3 && !ganador) {
  ganador = true;
  document.getElementById('result').innerHTML =
    `üéâ Felicidades ${username.toUpperCase()}, ganaste ${emoji} ${tipo}`;
  document.querySelectorAll('.card').forEach(c => c.onclick = null);

  // üëâ Esta l√≠nea es la que guarda en la nube
  registrarGiro(`${tipo} ${emoji}`);
}
}
async function yaJugoHoy(usuario) {
  try {
    const { data, error } = await client
      .from('giros')
      .select('premio, usuario')
      .eq('fecha', hoy)
      .eq('casino', casino)
      .or(`usuario.eq.${usuario},fingerprint.eq.${fingerprint}`)
      .limit(1)
      .maybeSingle();

    if (error) {
      console.error("‚ùå Error consultando Supabase:", error);
      return null;
    }

    return data ? { premio: data.premio, usuarioReal: data.usuario } : null;
  } catch (e) {
    console.error("‚ùå Excepci√≥n en yaJugoHoy:", e);
    return null;
  }
}
async function registrarGiro(premio) {
  const hora = new Date().toISOString();
  await client.from('giros').insert([{
    usuario: username,
    fingerprint,
    premio,
    fecha: hoy,
    hora,
    casino
  }]);
}
</script>
</body>
</html>
